/*! 2024-03-08 */
KISSY.add("UFO/util/Storage",function(t,e){return{setItem:function(t,e,n){var r=typeof n;"string"==r||"number"==r||"boolean"==r?t.setItem(e,n):t.setItem(e,JSON.stringify(n))},getItem:function(e,t){e=e.getItem(t);try{return JSON.parse(e)}catch(t){return e}},setLocalItem:function(t,e){this.setItem(localStorage,t,e)},getLocalItem:function(t){return this.getItem(localStorage,t)},setSessionItem:function(t,e){this.setItem(sessionStorage,t,e)},getSessionItem:function(t){return this.getItem(sessionStorage,t)}}},{requires:["node"]}),KISSY.add("app/util/ParamUtil",function(r){return{processParam:function(t){for(var e in t){var n=t[e];r.isArray(n)&&(t[e]=n[0])}return t}}}),KISSY.add("UFO/core/lang/Number",function(t){return{toSignedNumberString:function(t,e){return 0<t?"+"+String(t):0==t?(e||"")+String(t):String(t)},toHex:function(t){return t.toString(16)},toAmountWords:function(t){for(var e=["","万","亿"],n=["拾","佰","仟"],r=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],i=String(t).split("."),s=0,o=0,a=0,u="",c=0,l=1,h=i[0].length;l<=h;l++){var c=i[0].charAt(h-l),d=0;0<=h-l-1&&(d=i[0].charAt(h-l-1)),0!=(a+=Number(c))&&(u=r[Number(c)].concat(u),"0"==c)&&(a=0),0<=h-l-1&&(3!=s?(0!=d&&(u=n[s].concat(u)),s++):("万"!=u.charAt(s=0)&&"亿"!=u.charAt(0)||(u=u.substr(1,u.length-1)),u=e[o].concat(u),a=0)),3==s&&o++}return u+="元",i[1]?(0!=(c=i[1].charAt(0))&&(u+=r[Number(c)]+"角"),0!=(c=i[1].charAt(1))&&(u+=r[Number(c)]+"分")):u+="整",u}}}),KISSY.add("UFO/core/lang/Date",function(t,o){return{getMonthName:function(t,e){return(!0===e?["&#74;&#97;&#110;","&#70;&#101;&#98;","&#77;&#97;&#114;","&#65;&#112;&#114;","&#77;&#97;&#121;","&#74;&#117;&#110;","&#74;&#117;&#108;","&#65;&#117;&#103;","&#83;&#101;&#112;","&#79;&#99;&#116;","&#78;&#111;&#118;","&#68;&#101;&#99;"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"])[t.getMonth()]},getWeekName:function(t,e){return(!0===e?["&#83;&#117;&#110;","&#77;&#111;&#110;","&#84;&#117;&#101;","&#87;&#101;&#100;","&#84;&#104;&#117;&#114;","&#70;&#114;&#105;","&#83;&#97;&#116;"]:["Sun","Mon","Tue","Wed","Thur","Fri","Sat"])[t.getDay()]},format:function(t,e){if(!t)return"";e=e||"yyyy-MM-dd mm:ss";var n,r,i,s={TZ:o.toSignedNumberString(parseInt(-t.getTimezoneOffset()/60)),"q+":Math.floor((t.getMonth()+3)/3),"y+":t.getFullYear(),MN:this.getMonthName(t,!0),"M+":t.getMonth()+1,"d+":t.getDate(),WN:this.getWeekName(t),"h+":t.getHours(),"H+":(n=t.getHours())<13?n:n-12,"m+":t.getMinutes(),MP:t.getMinutes()-(new Date).getMinutes(),"s+":t.getSeconds(),DP:t.getHours()<12?"AM":"PM"};for(r in s)new RegExp("("+r+")").test(e)&&(i=RegExp.$1,e=e.replace(i,function(){return"yy"===i?s[r]%100:1<i.length&&"number"==typeof s[r]&&-1<s[r]&&s[r]<10?"0"+s[r]:s[r]}));return e}}},{requires:["./Number"]}),KISSY.add("app/util/XTemplateUtil",function(i,t,s){return t.addCommand("getImgAbsolutePath",function(t,e){e=e.params[0];return e?"../resources/img/"+e:"../resources/img/default_product.png"}),t.addCommand("formatPrice",function(t,e){return Number(e.params[0]).toFixed(2)}),t.addCommand("formatDateTime",function(t,e){var n=e.params[0],r="yyyy-MM-dd";return i.isNumber(n)&&(n=new Date(n)),2===e.params.length&&(r=e.params[1]),s.format(n,r)}),t.addCommand("fixedDigits",function(t,e){var n=2;return 2===e.params.length&&(n=e.params[1]),Number(e.params[0]).toFixed(n)}),t.addCommand("join",function(t,e){var n=",";return 2===e.params.length&&(n=e.params[1]),e.params[0].join(n)}),t.addCommand("getHost",function(t,e){return location.host}),t.addCommand("encodeURIComponent",function(t,e){return encodeURIComponent(e.params[0])}),{}},{requires:["xtemplate","UFO/core/lang/Date"]}),KISSY.add("app/app",function(t,e,n,r){var i=n.processParam(t.unparam(decodeURIComponent(location.search.slice(1)))),s=(navigator.userAgent.toLowerCase(),"yql_user"),n=void 0;return 0<(t=location.pathname.lastIndexOf("build/"))?n=location.pathname.substring(0,t)+"build/data":0<(t=location.pathname.lastIndexOf("src/"))&&(n=location.pathname.substring(0,t)+"src/data"),console.log("api_path",n),{API_HOST:location.protocol+"//"+location.host+n,IMG_BASE_URL:"./resources/img",VERSION:"1.0.0",setSessionUser:function(t){e.setSessionItem(s,t)},getSessionUser:function(){return e.getSessionItem(s)},isLogined:function(){return!!this.getSessionUser()},getParam:function(){return i},isMicroMessenger:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},notifyApp:function(t,e){var n,r=navigator.userAgent;"micromessenger"==r.toLowerCase().match(/MicroMessenger/i)?window.location="down.html":(r.match(/(iPhone|iPod|iPad);?/i)?window.location=t:r.match(/android/i)&&(window.location=e),n=+new Date,setTimeout(function(){window.document.webkitHidden||setTimeout(function(){+new Date-n<2e3&&(window.location="down.html")},500)},500))}}},{requires:["UFO/util/Storage","./util/ParamUtil","./util/XTemplateUtil"]}),KISSY.add("app/Action",function(u,t,c){var l=u;return{ajax2:function(t){u.mix(t,{dataType:"json",headers:{"X-Requested-With":!1}},!1);var e=c.getSessionUser();return e&&(t.data=u.mix({user_id:e.user_id,token:e.token},t.data)),t.data=u.mix({version:c.version},t.data),l.io(t)},ajax:function(t){return t.url=c.API_HOST+t.url,this.ajax2(t)},query:function(t,e,n,r){return this.ajax({type:"GET",url:t,data:e,success:n,error:function(t){r&&r(t),alert("网络错误"),console.error(t)}})},post:function(t,e,n,r){return this.ajax({type:"post",url:t,data:e,success:n,error:function(t){r&&r(t),alert("网络错误"),console.error(t)}})},update:function(t,e,n,r){return this.post(t,e,n,r)},uploadImage2:function(t){var e=new XMLHttpRequest,n=(t.updateProgress&&e.addEventListener("progress",t.updateProgress,!1),t.success&&e.addEventListener("load",t.success,!1),t.error&&e.addEventListener("error",t.error,!1),t.transferCanceled&&e.addEventListener("abort",t.transferCanceled,!1),new FormData);n.append("uploadImage",t.file),e.open("post",c.API_HOST+"/v2/upload_image",!0),e.send(n)},postFormData:function(t,e,n,r){u.isString(t)?i={}:(t=(i=t).url,e=i.data,n=i.success,r=i.error);var i,s,o=c.getSessionUser(),a=(o&&u.mix(e,{user_id:o.user_id,token:o.token},!1),new FormData);for(s in e)a.append(s,e[s]);return u.mix(i,{type:"post",url:c.API_HOST+t,data:a,dataType:"json",headers:{"X-Requested-With":!1},cache:!1,contentType:!1,processData:!1,success:n,error:r}),l.io(i)}}},{requires:["io","./app"]}),KISSY.add("UFO/EventSupport",function(a){function n(t,e){for(var n=0,r=e.length;n<r;n++){for(var i=e[n],s=0,o=0;s<t.length;s++)t[s]!=i&&(t[o++]=t[s]);t.length=o}}function t(t){this.listeners=this.listeners||{},this.oneTimeListeners=this.oneTimeListeners||{}}return UFO.augment(t,{on:function(t,e){var n=this.listeners[t]||[];return(n=a.isArray(n)?n:[n]).push(e),this.listeners[t]=n,this},off:function(t,e){return this.listeners[t]&&n(this.listeners[t],e),this.oneTimeListeners[t]&&n(this.oneTimeListeners[t],e),this},one:function(t,e){return this.oneTimeListeners[t]=this.oneTimeListeners[t]||[],this.oneTimeListeners[t].push(e),this},fire:function(){var t=[],e=arguments[0],n=Array.prototype.slice.call(arguments,1),r=this.listeners[e],i=this.oneTimeListeners[e];if(r)for(var s=0,o=(r=a.isArray(r)?r:[r]).length;s<o;s++)t.push(r[s].apply(this,n));if(i)for(s=0,o=(i=a.isArray(i)?i:[i]).length;s<o;s++)t.push(i[s].apply(this,n));return i=[],1==t.length?t[0]:t},fireEvent:function(){return this.fire.apply(this,arguments)},hasListener:function(t){return this.listeners[t]},relayEvents:function(t,e,n){for(var r,i=e.length,s=0;s<i;s++)r=e[s],t.on(r,this.createRelayer(n?n+r:r))},createRelayer:function(t,e){var n=this;return function(){return n.fireEvent.apply(n,[t].concat(Array.prototype.slice.apply(arguments,e||[0])))}}}),t}),KISSY.add("UFO/ComponentQuery",function(h){function o(t,e){return e.method.apply(this,[t].concat(e.args))}function a(t,e){for(var n,r=[],i=0,s=t.length,o=">"!==e;i<s;i++)(n=t[i]).getRefItems&&(r=r.concat(n.getRefItems(o)));return r}function l(t,e,n){if("*"===e)return t.slice();for(var r,i=[],s=0,o=t.length;s<o;s++)(r=t[s])&&r.isType&&r.isType(e,n)&&i.push(r);return i}function d(t,e){for(var n,r=[],i=0,s=t.length;i<s;i++)(n=t[i]).hasCls(e)&&r.push(n);return r}function f(t,e){for(var n,r=[],i=0,s=t.length;i<s;i++)(n=t[i]).getId()===e&&r.push(n);return r}var p=this,m=/^(\s?([>\^])\s?|\s|$)/,g=/^(#)?([\w\-]+|\*)(?:\((true|false)\))?/,y=[{re:/^\.([\w\-]+)(?:\((true|false)\))?/,method:l},{re:/^(?:[\[](?:@)?([\w\-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]])/,method:function(t,e,n,r){for(var i,s=[],o=0,a=t.length;o<a;o++)i=t[o],(r?String(i[e])===r:i[e])&&s.push(i);return s}},{re:/^#([\w\-]+)/,method:f},{re:/^\:([\w\-]+)(?:\(((?:\{[^\}]+\})|(?:(?!\{)[^\s>\/]*?(?!\})))\))?/,method:function(t,e,n){return p.pseudos[e](t,n)}}],u=(p.Query=function(t){t=t||{},UFO.apply(this,t)},UFO.augment(p.Query,{execute:function(t){var e,n,r=this.operations,i=0,s=r.length;for(h.isArray(t)&&(n=t);i<s;i++)if(n="^"===(e=r[i]).mode?function(t){for(var e,n=[],r=0,i=t.length;r<i;r++)for(e=t[r];e=e.ownerCt||e.floatParent;)n.push(e);return n}(n||[t]):e.mode?a(n||[t],e.mode):o(n||a([t]),e),i===s-1)return n;return[]},is:function(t){var e,n,r=this.operations,i=h.isArray(t)?t:[t],t=i.length,s=r[r.length-1];if((i=o(i,s)).length!==t)return!1;if(1<r.length)for(n=0,e=i.length;n<e;n++)if(-1===h.indexOf(this.execute(),i[n]))return!1;return!0}}),{cache:{},pseudos:{not:function(t,e){for(var n,r=u,i=0,s=t.length,o=[],a=-1;i<s;++i)n=t[i],r.is(n,e)||(o[++a]=n);return o},first:function(t){var e=[];return 0<t.length&&e.push(t[0]),e},last:function(t){var e=t.length,n=[];return 0<e&&n.push(t[e-1]),n}},query:function(t,e){for(var n,r,i,s=t.split(","),o=s.length,a=0,u=[],c=[],l={};a<o;a++)t=h.trim(s[a]),n=this.cache[t]||(this.cache[t]=this.parse(t)),u=u.concat(n.execute(e));if(1<(r=u.length)){for(a=0;a<r;a++)i=u[a],console.log("cmp.id",i.id),l[i.id]||(c.push(i),l[i.id]=!0);u=c}return u},is:function(t,e){if(!e)return!0;for(var n=e.split(","),r=n.length,i=0;i<r;i++)if(e=h.trim(n[i]),(this.cache[e]||(this.cache[e]=this.parse(e))).is(t))return!0;return!1},parse:function(t){for(var e,n,r,i,s,o,a,u=[],c=y.length;t&&e!==t;){for((n=(e=t).match(g))&&(r=n[1],u.push("#"===r?{method:f,args:[h.trim(n[2])]}:"."===r?{method:d,args:[h.trim(n[2])]}:{method:l,args:[h.trim(n[2]),Boolean(n[3])]}),t=t.replace(n[0],""));!(i=t.match(m));)for(o=0;t&&o<c;o++){if(a=y[o],s=t.match(a.re),a.method,s){u.push({method:a.method,args:s.slice(1)}),t=t.replace(s[0],"");break}o===c-1&&console.error('Invalid ComponentQuery selector: "'+arguments[0]+'"')}i[1]&&(u.push({mode:i[2]||i[1]}),t=t.replace(i[0],""))}return new p.Query({operations:u})}});return u}),KISSY.add("UFO/Component",function(r,t,e,n){var i="<div></div>";function s(t){this.config=t||{},r.mix(this,t,!0,void 0,!0),this.id=r.guid(),this.tplId&&(i=this.tpl=r.one("#"+this.tplId).html()),s.superclass.constructor.call(this,t),this.initComponent()}return r.extend(s,e),UFO.augment(s,{alias:"component",initComponent:function(){this.el||(i=this.tpl||i,this.el=r.all(i)),this.bodyStyle=r.mix(this.bodyStyle||{},{padding:this.bodyPadding},!0),this.getBodyContainer().css(this.bodyStyle),this.style=r.mix(this.style||{},{padding:this.padding,margin:this.margin}),this.el.css(this.style),this.cls&&this.addClass(this.cls),this.bodyCls&&this.getBodyContainer().addClass(this.bodyCls),this.attributes&&this.el.attr(this.attributes),this.addCmpEvents()},setSize:function(t,e){this.el.width(t),this.el.height(e)},toEl:function(){return this.el},getEl:function(){return this.toEl()},getTargetEl:function(){},getBodyContainer:function(){return this.el},getContentTarget:function(){return this.el},render:function(t){(t="string"==typeof t?(t=r.one("#"+t))||r.one(t):t).append(this.toEl()),this.fire("afterrender",this)},onAdded:function(t,e){this.ownerCt=t,this.fireEvent("added",this,t,e)},css:function(t,e){var n=Array.prototype.slice.call(arguments,0);return 1===n.length&&r.isString(n[0])?el.css(t):this.el.css(t,e),this},removeClass:function(t){return this.el.removeClass(t),this},addClass:function(t){return this.el.addClass(t),this},hasClass:function(t){return this.el.hasClass(t)},hasCls:function(t){return this.hasClass(t)},setDisabled:function(t){(this.disabled=t)?this.el.attr("disabled","disabled"):this.el.attr("disabled","")},show:function(){return!1!==this.fire("beforeshow")&&(this.el.show(),this.fire("show")),this},hide:function(t){var e=this;return!1!==this.fire("beforehide")&&(this.el.hide(),e.destroy&&(e.el.remove(),delete e),e.fire("hide"),t)&&t(),this},getRootContainer:function(){return this.rootContainer},getId:function(){return this.id},up:function(t){var e=this.getBubbleTarget();if(t)for(;e;e=e.getBubbleTarget())if(n.is(e,t))return e;return e},getBubbleTarget:function(){return this.ownerCt},addCmpEvents:function(){},set:function(t,e){this[t]=e},get:function(t){return this[t]},isType:function(t){return UFO.isType(this,t)}}),s},{requires:["node","./EventSupport","./ComponentQuery"]}),KISSY.add("app/example/tpl/artisan-list-tpl",function(){return'<div class="list"></div>'}),KISSY.add("app/example/tpl/artisan-list-item-tpl",function(){return'{{#each data}}\n<a class="item item-avatar" href="./artisanDetail?artisan_id={{artisan_id}}">\n  <img src="{{getImgAbsolutePath avatar}}">\n  <h2>{{name}}</h2>\n  <p>服务次数{{service_count}}</p>\n</a>\n{{/each}}'}),KISSY.add("app/example/mods/ArtisanList",function(t,e,n,r,i,s,o,a){var u=new n(a);function c(){c.superclass.constructor.apply(this,arguments)}return KISSY.extend(c,i),UFO.augment(c,{alias:"artisanlist",initComponent:function(){console.log("ArtisanList init"),this.el=t.one(o),c.superclass.initComponent.apply(this,arguments),this.init()},init:function(){this.load()},load:function(t,e){var n=this;r.query("/artisans.json",{offset:0,page_size:20,city:"110100",filter_type:"1",business_district_ids:"205"},function(t){t.ret?n.el.append(u.render(t)):(alert(JSON.stringify(t)),e&&e(t))},function(t){console.log("msg",t),e&&e(t)})},addCmpEvents:function(){c.superclass.addCmpEvents.apply(this,arguments)}}),c},{requires:["node","xtemplate","../../Action","UFO/Component","../../util/XTemplateUtil","../tpl/artisan-list-tpl","../tpl/artisan-list-item-tpl"]});